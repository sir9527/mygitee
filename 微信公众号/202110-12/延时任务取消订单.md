



[TOC]



参考文章：https://mp.weixin.qq.com/s/79F46OVHk04MefCunimDxw



延时任务的需求

- 生成订单30分钟未支付，则自动取消
- 生成订单60秒后，给用户发短信





延时任务和定时任务

- 定时任务有明确的触发时间，延时任务没有
- 定时任务有执行周期，而延时任务在某事件触发后一段时间内执行，没有执行周期
- 定时任务一般执行的是批处理操作是多个任务，而延时任务一般是单个任务





## 方案1：数据库轮询（参考）

该方案通常是在小型项目中使用，即通过一个**线程定时**的去扫描数据库，通过**订单时间**来判断是否有超时的订单，然后进行update或delete等操作。相当于用定时任务去做



## 方案2：JDK的延迟队列DelayQueue

服务器重启后，数据全部消失，怕宕机



## 方案3：时间轮算法

用Netty的HashedWheelTimer来实现

服务器重启后，数据全部消失，怕宕机



## 方案4：Redis缓存

使用zset



## 方案5：使用消息队列（推荐）

RabbitMQ设置生存时间x-message-tt，过期则放入死信队列



















