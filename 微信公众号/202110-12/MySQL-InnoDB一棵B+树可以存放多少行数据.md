



## 1.InnoDB一棵B+树可以存放多少行数据？

```markdown

  约2千万行(高度是3的B+树，如果超过2千万，B+树高度变4，就需要考虑分表了)
  
  B+树的存放总记录数为 = 根结点指针数 * 单个叶子节点记录行数
  
  叶子节点：数据。如果一行记录的数据大小为1k，那么单个叶子节点可以存的记录数 =16k/1k = 16
  
  非叶子节点：指针+主键
    假设主键ID为bigint类型，长度为8字节；而指针大小在InnoDB源码中设置为6字节，所以就是8+6=14字节
    16k/14B =16*1024B/14B = 1170
  一棵高度为2的B+树，能存放1170 * 16 = 18720条这样的数据记录
  一棵高度为3的B+树，能存放1170 * 1170 * 16 = 21902400（2千万）

注：在计算机中，磁盘存储数据最小单元是扇区，一个扇区的大小是512字节。
   文件系统中，最小单位是块，一个块大小就是4k；
   InnoDB存储引擎最小储存单元是页，一页大小就是16k

```



 

**主键索引**

- 非叶子节点存储主键和页号
- 叶子节点存储完整的数据
- 叶子节点之间有双向链表链接，便于范围查询
- 叶子节点内部有页目录，内部记录是单链表链接，通过页目录二分再遍历链表即可得到对应记录。
- B+ 树只能帮助快速定位到的是页，而不是记录。
- 页大小默认16k，是按照主键大小排序的，所以无序的记录插入因为排序会插入到页中间，又因为容量有限会导致页分裂存储，性能比较差，所以主键要求有序



**非主键索引**

- 和主键索引的差别就在于叶子节点存储索引列和主键，没有完整的数据 





![](https://gitee.com/domineering_red_tide/image/raw/master/image/20210615203323.png)







